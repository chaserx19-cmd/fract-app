<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Decimal ↔ Fraction</title>

  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Fraction">
  <meta name="theme-color" content="#111111">

  <style>
    :root { color-scheme: light dark; }
    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      max-width: 820px;
      margin: 24px auto;
      padding: 0 16px 28px;
      line-height: 1.2;
      -webkit-text-size-adjust: 100%;
    }
    h1{ margin: 0 0 14px 0; font-size: 22px; opacity: .9; }

    .row{
      display:flex;
      gap: 12px;
      flex-wrap:wrap;
      align-items:center;
    }
    input{
      flex: 1;
      min-width: 280px;
      font-size: 22px;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(127,127,127,.35);
      outline: none;
    }

    .group{ display:flex; gap: 10px; flex-wrap:wrap; align-items:center; }

    .btn{
      font-size: 18px;
      padding: 12px 14px;
      border-radius: 16px;
      border: 1px solid rgba(127,127,127,.35);
      background: transparent;
      cursor: pointer;
      user-select: none;
      touch-action: manipulation;
      transition: background-color .12s ease, border-color .12s ease, transform .06s ease;
    }
    .btn:active{ transform: scale(0.98); }

    /* Full-button selected state */
    .btn.active{
      border-width: 2px;
      font-weight: 800;
      background: rgba(127,127,127,.22);
      border-color: rgba(127,127,127,.55);
    }

    /* Make selected state more obvious in light mode */
    @media (prefers-color-scheme: light) {
      .btn.active{
        background: rgba(0,0,0,.10);
        border-color: rgba(0,0,0,.25);
      }
    }

    .card{
      margin-top: 16px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(127,127,127,.25);
    }
    .big{
      font-size: 40px;
      font-weight: 800;
      letter-spacing: .2px;
      font-variant-numeric: tabular-nums;
    }
    .copyrow{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
    }
    .meta{
      margin-top: 14px;
      display:grid;
      gap: 10px;
      font-size: 16px;
    }
    .line{ display:flex; justify-content:space-between; gap: 14px; }
    .k{ opacity:.75; }
    .v{ font-variant-numeric: tabular-nums; }
    .muted{ margin-top: 14px; opacity:.7; font-size: 14px; }
  </style>
</head>
<body>
  <h1>Decimal → Fraction</h1>

  <div class="row">
    <input id="val" placeholder="Type a number… e.g. 14.611 or 25.4" autocomplete="off" />

    <div class="group" aria-label="Units">
      <button class="btn active" id="uIn" type="button">IN</button>
      <button class="btn" id="uMm" type="button">MM</button>
    </div>

    <div class="group" id="denoms" aria-label="Tolerance"></div>
  </div>

  <div class="card">
    <div id="out" class="big">—</div>

    <div class="copyrow">
      <button class="btn" id="copyFrac" type="button">Copy fraction</button>
      <button class="btn" id="copyDecIn" type="button">Copy decimal in (rounded)</button>
      <button class="btn" id="copyDecMm" type="button">Copy decimal mm (rounded)</button>
    </div>

    <div class="meta">
      <div class="line"><div class="k">Decimal inches (exact)</div><div class="v" id="decIn">—</div></div>
      <div class="line"><div class="k">Decimal mm (exact)</div><div class="v" id="decMm">—</div></div>
      <div class="line"><div class="k">Rounding error</div><div class="v" id="delta">—</div></div>
    </div>

    <div class="muted">
      Denominator sets tolerance (nearest 1/16, 1/32, 1/64, 1/128). Output is fractional inches.
      Copy buttons use <b>3 decimals</b>. Decimal copy uses the <b>rounded</b> value that matches the fraction.
    </div>
  </div>

<script>
  const elVal   = document.getElementById('val');
  const elOut   = document.getElementById('out');
  const elDecIn = document.getElementById('decIn');
  const elDecMm = document.getElementById('decMm');
  const elDelta = document.getElementById('delta');
  const elDenoms = document.getElementById('denoms');

  const btnIn = document.getElementById('uIn');
  const btnMm = document.getElementById('uMm');

  const denoms = [16, 32, 64, 128];
  let denom = 32;
  let units = 'in'; // 'in' or 'mm'

  function gcd(a, b){
    a = Math.abs(a); b = Math.abs(b);
    while (b) [a, b] = [b, a % b];
    return a || 1;
  }

  function parseNumber(raw){
    const s = (raw || '').trim();
    if (!s) return { ok:false, err:'Type a number.' };
    const cleaned = s.replace(/,/g,'');
    const m = cleaned.match(/[-+]?\d*\.?\d+(?:[eE][-+]?\d+)?/);
    if (!m) return { ok:false, err:'Could not find a number.' };
    const num = Number(m[0]);
    if (!Number.isFinite(num)) return { ok:false, err:'Invalid number.' };
    return { ok:true, num };
  }

  function formatMixedFractionFromInches(inches, denom){
    const scaled = Math.round(inches * denom);
    const rounded = scaled / denom;

    let whole = Math.trunc(scaled / denom);
    let rem = Math.abs(scaled % denom);

    if (rem === 0) return { text: `${whole}"`, rounded };

    const g = gcd(rem, denom);
    const r = rem / g;
    const d = denom / g;

    const text = (whole === 0) ? `${r}/${d}"` : `${whole} ${r}/${d}"`;
    return { text, rounded };
  }

  function setUnits(next){
    units = next;
    btnIn.classList.toggle('active', units === 'in');
    btnMm.classList.toggle('active', units === 'mm');
    update();
  }

  btnIn.addEventListener('click', () => setUnits('in'));
  btnMm.addEventListener('click', () => setUnits('mm'));

  function renderDenoms(){
    elDenoms.innerHTML = '';
    for (const d of denoms){
      const b = document.createElement('button');
      b.type = 'button';
      b.className = 'btn' + (d === denom ? ' active' : '');
      b.textContent = `1/${d}`;
      b.addEventListener('click', () => {
        denom = d;
        renderDenoms();
        update();
      });
      elDenoms.appendChild(b);
    }
  }

  // Copy helpers
  async function copyText(t){
    try { await navigator.clipboard.writeText(t); } catch {}
  }
  function toFixed3(n){
    // Avoid "-0.000"
    const v = Number(n.toFixed(3));
    return v.toFixed(3);
  }

  let last = {
    frac: '',
    roundedIn: NaN,
    roundedMm: NaN
  };

  document.getElementById('copyFrac').addEventListener('click', () => copyText(last.frac));
  document.getElementById('copyDecIn').addEventListener('click', () => {
    if (Number.isFinite(last.roundedIn)) copyText(toFixed3(last.roundedIn));
  });
  document.getElementById('copyDecMm').addEventListener('click', () => {
    if (Number.isFinite(last.roundedMm)) copyText(toFixed3(last.roundedMm));
  });

  function update(){
    const p = parseNumber(elVal.value);

    if (!p.ok){
      elOut.textContent = '—';
      elDecIn.textContent = '—';
      elDecMm.textContent = '—';
      elDelta.textContent = '—';
      last = { frac:'', roundedIn: NaN, roundedMm: NaN };
      return;
    }

    const raw = p.num;
    const inchesExact = (units === 'mm') ? (raw / 25.4) : raw;
    const mmExact = inchesExact * 25.4;

    const frac = formatMixedFractionFromInches(inchesExact, denom);
    const inchesRounded = frac.rounded;
    const mmRounded = inchesRounded * 25.4;

    elOut.textContent = frac.text;
    elDecIn.textContent = inchesExact.toFixed(6) + ' in';
    elDecMm.textContent = mmExact.toFixed(3) + ' mm';

    const deltaIn = inchesRounded - inchesExact;
    const deltaMm = deltaIn * 25.4;
    const sign = deltaIn >= 0 ? '+' : '';
    elDelta.textContent = `${sign}${deltaIn.toFixed(6)} in  (${sign}${deltaMm.toFixed(3)} mm)`;

    // What gets copied:
    last = {
      frac: frac.text.replace(/"/g,''),
      roundedIn: inchesRounded,
      roundedMm: mmRounded
    };
  }

  elVal.addEventListener('input', update);

  renderDenoms();
  update();
</script>
</body>
</html>
